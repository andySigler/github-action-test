name: Build Release

on:
  workflow_dispatch:
    inputs:
      choice:
        type: choice
        description: Production Test Name
        options:
        - script_a
jobs:
  build:
    runs-on: macos-10.15

    steps:
      - name: "Check out the Git repository"
        uses: actions/checkout@v2

      - name: "Set up Python"
        uses: actions/setup-python@v2
        with:
          python-version: 3.7

      - name: "Install package"
        run: python -m pip install -e .

      - name: "Read name from user input"
        id: get_test_name
        run: echo "::set-output name=name::${{ github.event.inputs.choice }}"

      - name: "Generate tag name"
        id: get_tag_name
        run: python -c "import github_action_test.utils.build as b; print('::set-output name=name::' + b.generate_tag_name_for_script('${{ steps.get_test_name.outputs.name }}'))"

      - name: "Check tag name"
        run: git tag ${{ steps.get_tag_name.outputs.name }} && git push --tags

